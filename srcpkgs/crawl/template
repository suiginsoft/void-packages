# Template file for 'crawl'
pkgname=crawl
version=0.19.1
revision=1
build_wrksrc="crawl-ref/source"
make_build_args="prefix=/usr bin_prefix=bin"
hostmakedepends="pkg-config perl"
makedepends="ncurses-devel lua51-devel sqlite-devel zlib-devel"
short_desc="Dungeon Crawl Stone Soup roguelike adventure"
maintainer="Christian Neukirchen <chneukirchen@gmail.com>"
license="GPL-2"
homepage="http://crawl.develz.org/"
distfiles="https://github.com/${pkgname}/${pkgname}/archive/${version}.tar.gz"
checksum=f31d605025be52239e1a401400bc3243219fb5d14088d9fc8a9db350a24eda98
nocross=yes

post_extract() {
	sed -i 's/defined(__ANDROID__)/& || !defined(__GLIBC__)/' ${build_wrksrc}/crash.cc
}

do_build() {
	echo $version >util/release_ver
	# crashes with relro?
	make ${makejobs} CC="$CC" CXX="$CXX" \
		EXTERNAL_FLAGS="$CFLAGS" V=1 build-rltiles
	make ${makejobs} CC="$CC" CXX="$CXX" \
		EXTERNAL_FLAGS="$CFLAGS" EXTERNAL_LDFLAGS="$LDFLAGS" \
		${make_build_args} V=1 DESTDIR=${DESTDIR}
}

do_install() {
	make CC="$CC" CXX="$CXX" \
		EXTERNAL_FLAGS="$CFLAGS" EXTERNAL_LDFLAGS="$LDFLAGS" \
		${make_build_args} DESTDIR=${DESTDIR} install
}
