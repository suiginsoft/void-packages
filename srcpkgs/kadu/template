# Template file for 'kadu'
pkgname=kadu
version=4.0
revision=1
build_style=cmake
configure_args="-DCMAKE_PREFIX_PATH=${XBPS_CROSS_BASE}/usr
 -DQCA2_INCLUDE_DIR=${XBPS_CROSS_BASE}/usr/include/QtCrypto
 -DQCA2_LIBRARIES=qca -DENABLE_TESTS=OFF -Wno-dev"
hostmakedepends="pkg-config qt5-plugin-mysql qt5-plugin-odbc
 qt5-plugin-pgsql qt5-plugin-sqlite qt5-plugin-tds"
makedepends="libao-devel libsndfile-devel libarchive-devel
 enchant-devel injeqt-devel libgadu-devel libotr-devel
 qt5-devel qt5-xmlpatterns-devel qt5-declarative-devel qt5-multimedia-devel
 qt5-script-devel qt5-svg-devel qt5-tools-devel qt5-webkit-devel qt5-x11extras-devel
 libmpdclient-devel qca-qt5-devel qxmpp-devel phonon-qt5-devel libXScrnSaver-devel"
depends="${pkgname}-data-${version}_${revision} hicolor-icon-theme qca-qt5-ossl 
 $(vopt_if mysql qt5-plugin-mysql) $(vopt_if odbc qt5-plugin-odbc)
 $(vopt_if pgsql qt5-plugin-pgsql) $(vopt_if sqlite qt5-plugin-sqlite)
 $(vopt_if tds qt5-plugin-tds)"
short_desc="Instant Messenger client"
maintainer="Jürgen Buchmüller <pullmoll@t-online.de>"
license="GPL-2"
homepage="http://www.kadu.im/"
distfiles="http://download.kadu.im/stable/${pkgname}-${version}.tar.bz2"
checksum=7ac4e7728be9f985ff4e88a20fa468b163322bcbf8bd8284a93f680a3d3cb74e

build_options="mysql odbc pgsql sqlite tds"
build_options_default="sqlite"
desc_option_mysql="Use MySQL database plugin"
desc_option_odbc="Use ODBC database plugin"
desc_option_pgsql="Use PostgreSQL database plugin"
desc_option_sqlite="Use SQlite database plugin"
desc_option_tds="Use Tabular Data Stream database plugin"

pre_configure() {
	# Disable plugins which require pkgs Void does not ship (yet)
	# unity_integration: Ubuntu
	# indicator_docking: requires messaging-menu
	# word_fix: not packaged
	sed -i ${wrksrc}/Plugins.cmake \
		-e "s;unity_integration$;;" \
		-e "s;indicator_docking$;;" \
		-e "s;word_fix$;;"
	# Using the __useconds_t type is wrong here, see man usleep(3)
	sed -i ${wrksrc}/plugins/pcspeaker/pcspeaker-notifier.cpp \
		-e "s;__useconds_t;useconds_t;g"
}

kadu-data_package() {
	short_desc+=" - data files"
	noarch=yes
	pkg_install() {
		vmove usr/share/icons
		vmove "usr/share/kadu/configuration/*.ui"
		vmove usr/share/kadu/themes
		vmove usr/share/kadu/scripts
		vmove usr/share/kadu/syntax
		vmove "usr/share/kadu/plugins/*.desc"
		vmove "usr/share/kadu/plugins/configuration/*.ui"
		vmove usr/share/kadu/translations
		vmove usr/share/kadu/plugins/data
		vmove usr/share/kadu/plugins/translations
	}
}
kadu-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove usr/share/cmake
		vmove usr/share/kadu/sdk
	}
}
